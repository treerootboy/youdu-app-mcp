# æµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å« YouDu IM MCP Server é¡¹ç›®çš„æµ‹è¯•è„šæœ¬å’Œæµ‹è¯•æŠ¥å‘Šã€‚

---

## ç›®å½•ç»“æ„

```
test/
â”œâ”€â”€ README.md              # æœ¬æ–‡ä»¶
â”œâ”€â”€ reports/              # æµ‹è¯•æŠ¥å‘Š
â”‚   â”œâ”€â”€ http_api_test.md  # HTTP API æµ‹è¯•æŠ¥å‘Š
â”‚   â””â”€â”€ mcp_test.md       # MCP æœåŠ¡å™¨æµ‹è¯•æŠ¥å‘Š
â””â”€â”€ scripts/              # æµ‹è¯•è„šæœ¬
    â”œâ”€â”€ test_mcp_client.py    # MCP æµ‹è¯•å®¢æˆ·ç«¯
    â””â”€â”€ test_mcp.sh           # MCP Bash æµ‹è¯•è„šæœ¬
```

---

## æµ‹è¯•è„šæœ¬è¯´æ˜

### 1. MCP æµ‹è¯•å®¢æˆ·ç«¯ (Python)

**æ–‡ä»¶**: `scripts/test_mcp_client.py`

**åŠŸèƒ½**:
- å®Œæ•´çš„ MCP åè®®æµ‹è¯•å®¢æˆ·ç«¯
- è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
- æµ‹è¯•å·¥å…·åˆ—è¡¨ã€å·¥å…·è°ƒç”¨ã€æƒé™æ§åˆ¶

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /path/to/youdu-app-mcp
python3 test/scripts/test_mcp_client.py
```

**æµ‹è¯•è¦†ç›–**:
- MCP åˆå§‹åŒ–æ¡æ‰‹
- è·å–å·¥å…·åˆ—è¡¨ï¼ˆ28 ä¸ªå·¥å…·ï¼‰
- è°ƒç”¨å…è®¸çš„æ“ä½œï¼ˆget_user, send_text_messageï¼‰
- è°ƒç”¨ç¦æ­¢çš„æ“ä½œï¼ˆcreate_user, delete_userï¼‰
- æƒé™ç³»ç»ŸéªŒè¯

**è¾“å‡ºç¤ºä¾‹**:
```
ğŸ§ª å¯åŠ¨ MCP æœåŠ¡å™¨æµ‹è¯•...

ğŸ“‹ æµ‹è¯• 1: åˆå§‹åŒ– MCP è¿æ¥
âœ“ åˆå§‹åŒ–æˆåŠŸ

ğŸ“‹ æµ‹è¯• 2: è·å–å·¥å…·åˆ—è¡¨
âœ“ è·å–åˆ° 28 ä¸ªå·¥å…·
  - add_group_member: add group member
  - create_dept: create dept
  ...

âœ… æµ‹è¯• 3: è°ƒç”¨å…è®¸çš„æ“ä½œ - get_user (æƒé™: read=true)
âœ“ æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯

âŒ æµ‹è¯• 4: è°ƒç”¨è¢«ç¦æ­¢çš„æ“ä½œ - create_user (æƒé™: create=false)
âœ“ æƒé™æ§åˆ¶æ­£å¸¸ï¼Œæ“ä½œè¢«æ‹’ç»: æƒé™æ‹’ç»ï¼šä¸å…è®¸å¯¹èµ„æº 'user' æ‰§è¡Œ 'create' æ“ä½œ

ğŸ‰ MCP æœåŠ¡å™¨æµ‹è¯•å®Œæˆï¼

ğŸ“Š æµ‹è¯•æ€»ç»“:
  âœ… MCP åè®®å®ç°æ­£å¸¸
  âœ… å·¥å…·è‡ªåŠ¨æ³¨å†ŒæˆåŠŸ (28 ä¸ª)
  âœ… JSON Schema æ­£ç¡®ç”Ÿæˆ
  âœ… å…è®¸çš„æ“ä½œæ‰§è¡ŒæˆåŠŸ
  âœ… æƒé™æ§åˆ¶ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
```

---

### 2. MCP Bash æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `scripts/test_mcp.sh`

**åŠŸèƒ½**:
- ä½¿ç”¨ Bash + curl æµ‹è¯• MCP æœåŠ¡å™¨
- é€‚åˆå¿«é€ŸéªŒè¯

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /path/to/youdu-app-mcp
./test/scripts/test_mcp.sh
```

**æ³¨æ„**: éœ€è¦å®‰è£… `jq` å·¥å…·ç”¨äº JSON è§£æã€‚

---

## æµ‹è¯•æŠ¥å‘Šè¯´æ˜

### 1. HTTP API æµ‹è¯•æŠ¥å‘Š

**æ–‡ä»¶**: `reports/http_api_test.md`

**å†…å®¹**:
- æœåŠ¡å™¨å¯åŠ¨æµ‹è¯•
- è·¯ç”±æ³¨å†ŒéªŒè¯ï¼ˆ28 ä¸ª endpointsï¼‰
- å¥åº·æ£€æŸ¥æµ‹è¯•
- API åˆ—è¡¨è·å–æµ‹è¯•
- å…è®¸æ“ä½œæµ‹è¯•ï¼ˆå‘é€æ¶ˆæ¯ã€è·å–ç”¨æˆ·ï¼‰
- ç¦æ­¢æ“ä½œæµ‹è¯•ï¼ˆåˆ›å»ºç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ï¼‰
- æƒé™ç³»ç»ŸéªŒè¯
- æ€§èƒ½æµ‹è¯•æ•°æ®

**æµ‹è¯•é€šè¿‡ç‡**: 100% (8/8)

---

### 2. MCP æœåŠ¡å™¨æµ‹è¯•æŠ¥å‘Š

**æ–‡ä»¶**: `reports/mcp_test.md`

**å†…å®¹**:
- MCP åè®®å®ç°éªŒè¯
- åˆå§‹åŒ–æ¡æ‰‹æµ‹è¯•
- å·¥å…·åˆ—è¡¨è·å–ï¼ˆ28 ä¸ªå·¥å…·ï¼‰
- JSON Schema ç”ŸæˆéªŒè¯
- å·¥å…·è°ƒç”¨æµ‹è¯•
- æƒé™ç³»ç»ŸéªŒè¯
- ä¸ Claude Desktop é›†æˆè¯´æ˜

**æµ‹è¯•é€šè¿‡ç‡**: 100% (8/8)

---

## æµ‹è¯•ç¯å¢ƒè¦æ±‚

### ç³»ç»Ÿè¦æ±‚

- macOS / Linux / Windows
- Go 1.23.0+
- Python 3.x (ç”¨äº MCP æµ‹è¯•å®¢æˆ·ç«¯)

### ä¾èµ–å·¥å…·

- `jq` - JSON å‘½ä»¤è¡Œå¤„ç†å·¥å…·
- `curl` - HTTP å®¢æˆ·ç«¯

**å®‰è£…æ–¹æ³•** (macOS):
```bash
brew install jq curl
```

### é…ç½®è¦æ±‚

æµ‹è¯•å‰éœ€è¦é…ç½®ï¼š

1. **YouDu é…ç½®** (`config.yaml`):
```yaml
youdu:
  addr: "https://youdu.example.com"
  buin: 123456789
  app_id: "your_app_id"
  aes_key: "your_aes_key"
```

2. **æƒé™é…ç½®** (`permission.yaml`):
```yaml
permission:
  enabled: true
  allow_all: false
  resources:
    user:
      create: false
      read: true
      update: false
      delete: false
    message:
      create: true
      read: true
      update: false
      delete: false
```

---

## è¿è¡Œæ‰€æœ‰æµ‹è¯•

### è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

```bash
# 1. æ„å»ºé¡¹ç›®
go build -o bin/youdu-cli ./cmd/youdu-cli
go build -o bin/youdu-mcp ./cmd/youdu-mcp

# 2. è¿è¡Œ MCP æµ‹è¯•
python3 test/scripts/test_mcp_client.py

# 3. è¿è¡Œ HTTP API æµ‹è¯•ï¼ˆæ‰‹åŠ¨ï¼‰
# å¯åŠ¨ API æœåŠ¡å™¨
./bin/youdu-cli serve-api --port 8080

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•
curl http://localhost:8080/health
curl http://localhost:8080/api/v1/endpoints
curl -X POST http://localhost:8080/api/v1/send_text_message \
  -H "Content-Type: application/json" \
  -d '{"to_user":"10232","content":"æµ‹è¯•æ¶ˆæ¯"}'
```

---

## æµ‹è¯•è¦†ç›–èŒƒå›´

### å·²æµ‹è¯•

- âœ… MCP åè®®åŸºç¡€åŠŸèƒ½
- âœ… HTTP API åŸºç¡€åŠŸèƒ½
- âœ… å·¥å…·/è·¯ç”±è‡ªåŠ¨æ³¨å†Œ
- âœ… JSON Schema ç”Ÿæˆ
- âœ… æƒé™æ§åˆ¶ç³»ç»Ÿ
- âœ… å®é™…ä¸šåŠ¡æ“ä½œï¼ˆå‘é€æ¶ˆæ¯ã€è·å–ç”¨æˆ·ï¼‰

### å¾…æµ‹è¯•

- â³ æ‰€æœ‰ 28 ä¸ªå·¥å…·çš„è¯¦ç»†æµ‹è¯•
- â³ å¹¶å‘æ€§èƒ½æµ‹è¯•
- â³ è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- â³ å¼‚å¸¸æƒ…å†µå¤„ç†
- â³ ä¸ Claude Desktop å®é™…é›†æˆæµ‹è¯•

---

## è´¡çŒ®æµ‹è¯•

æ¬¢è¿è´¡çŒ®æ–°çš„æµ‹è¯•ç”¨ä¾‹å’Œæµ‹è¯•è„šæœ¬ï¼

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ `scripts/` ç›®å½•æ·»åŠ æµ‹è¯•è„šæœ¬
2. åœ¨ `reports/` ç›®å½•æ·»åŠ æµ‹è¯•æŠ¥å‘Š
3. æ›´æ–°æœ¬ README.md

### æµ‹è¯•è§„èŒƒ

- æµ‹è¯•è„šæœ¬åº”åŒ…å«æ¸…æ™°çš„æ³¨é‡Š
- æµ‹è¯•æŠ¥å‘Šåº”åŒ…å«è¯¦ç»†çš„æ­¥éª¤å’Œç»“æœ
- æµ‹è¯•åº”å¯é‡å¤æ‰§è¡Œ
- æµ‹è¯•åº”æœ‰æ˜ç¡®çš„é€šè¿‡/å¤±è´¥æ ‡å‡†

---

## æµ‹è¯•ç»“æœæ€»ç»“

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡ | å¤±è´¥ | é€šè¿‡ç‡ |
|---------|----------|------|------|--------|
| HTTP API | 8 | 8 | 0 | 100% |
| MCP æœåŠ¡å™¨ | 8 | 8 | 0 | 100% |
| **æ€»è®¡** | **16** | **16** | **0** | **100%** |

---

## é—®é¢˜åé¦ˆ

å¦‚å‘ç°æµ‹è¯•é—®é¢˜ï¼Œè¯·æäº¤ Issue å¹¶åŒ…å«ï¼š
- æµ‹è¯•ç¯å¢ƒä¿¡æ¯
- å¤ç°æ­¥éª¤
- é”™è¯¯æ—¥å¿—
- æœŸæœ›è¡Œä¸º

---

**æœ€åæ›´æ–°**: 2025-10-17
**ç»´æŠ¤è€…**: YouDu å¼€å‘å›¢é˜Ÿ
